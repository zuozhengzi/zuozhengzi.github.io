"use strict";const CACHE_NAME="szcache",RESOURCES=[["index.html","update.js"],["manifest.json","favicon.png","icon.png"]];var lastCheckUpdateTime=0;function getResKey(A){var R=(R=registration.scope)||location.origin,A=A.url.substring(R.length);return A=""==(A="/"==A.substring(0,1)?A.substring(1):A)||"/"==A||A.startsWith("#")||A.startsWith("?v=")||A.startsWith("?_=")?"index.html":A}async function reloadAll(){return caches.open(CACHE_NAME).then(O=>{O.keys().then(function(A){A.forEach(function(A,R,U){if(A){var w=A.url.split("/").pop();-1===RESOURCES[1].indexOf(w)&&O.delete(A)}})});var U=registration.scope;RESOURCES[0].forEach(R=>{fetch(U+R).then(A=>{O.put(U+R,A.clone());"index.html"==R&&O.put(U,A.clone())})})}).catch(A=>{caches.delete(CACHE_NAME)})}async function checkUpdate(){try{var A=registration.scope+"update.js",R=await fetch(A,{cache:"reload"}),U=await R.text();if(!U||!U.match(/^\d+$/))return;var w=await caches.open(CACHE_NAME);if(!(R=await w.match(A)))return w.put(A,new Response(U)),void 0;var O=await R.text();O!=U&&reloadAll()}catch(A){}}self.addEventListener("fetch",A=>{if("GET"===A.request.method){var R=getResKey(A.request);if(-1!==RESOURCES[1].indexOf(R))return cacheOnly(A);if(-1!==RESOURCES[0].indexOf(R)){if("index.html"==R){R=+new Date;if(36e5<R-lastCheckUpdateTime){lastCheckUpdateTime=R;checkUpdate()}}return cacheFirst(A)}}});self.addEventListener("message",A=>{"skipWaiting"===A.data&&self.skipWaiting()});self.addEventListener("install",A=>A.waitUntil(self.skipWaiting()));self.addEventListener("activate",function(A){return A.waitUntil(async function(){await reloadAll();await self.clients.claim()}())});function cacheOnly(R){return R.respondWith(caches.open(CACHE_NAME).then(A=>A.match(R.request)))}function cacheFirst(U){return U.respondWith(caches.open(CACHE_NAME).then(R=>R.match(U.request).then(A=>A||fetch(U.request).then(A=>{R.put(U.request,A.clone());return A}))))}